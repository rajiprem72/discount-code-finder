<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discount Code Finder</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 0; }
  #videoContainer { width: 100%; max-width: 360px; margin: 20px auto; position: relative; }
  #player { width: 100%; aspect-ratio: 9/16; }
  #getCodeBtn { display: none; padding: 10px 20px; font-size: 18px; cursor: pointer; margin-top: 10px; }
  #couponPage { display: none; margin-top: 20px; }
  select, button { padding: 8px; font-size: 16px; }
  #couponResult { margin-top: 15px; font-size: 18px; font-weight: bold; text-align: left; width: 80%; margin: 15px auto; }
</style>
</head>
<body>

<h1>Discount Code Finder</h1>
<p>Watch the video below. The discount code finder will appear after the video completes.</p>
<p><a href="https://www.youtube.com/@PremanandhanNarayanan/?sub_confirmation=1" target="_blank">
  Subscribe to our YouTube Channel</a></p>

<div id="videoContainer">
  <div id="player"></div>
  <button id="getCodeBtn">Get My Discount Code</button>
</div>

<div id="couponPage">
  <label for="merchantSelect">Select Merchant:</label><br>
  <select id="merchantSelect">
    <optgroup label="E-commerce & General Shopping">
      <option value="Amazon">Amazon</option>
      <option value="Myntra">Myntra</option>
      <option value="Ajio">Ajio</option>
      <option value="Tata Cliq">Tata Cliq</option>
      <option value="Snapdeal">Snapdeal</option>
    </optgroup>
    <optgroup label="Food & Grocery">
      <option value="Swiggy">Swiggy</option>
      <option value="Zomato">Zomato</option>
      <option value="Blinkit">Blinkit (formerly Grofers)</option>
      <option value="Zepto">Zepto</option>
    </optgroup>
  </select>
  <button onclick="findCoupon()">Find Coupon</button>
  <div id="couponResult"></div>
</div>

<script>
  let selectedVideo;
  let player;

  // Load video list from JSON
  fetch('https://raw.githubusercontent.com/rajiprem72/discount-code-finder/main/videos.json')
    .then(response => response.json())
    .then(videos => {
      selectedVideo = videos[Math.floor(Math.random() * videos.length)];
      // Load YouTube API
      let tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      document.body.appendChild(tag);

      window.onYouTubeIframeAPIReady = function() {
        player = new YT.Player('player', {
          height: '640',
          width: '360',
          videoId: selectedVideo.id,
          playerVars: {
            autoplay: 1,
            controls: 1,
            rel: 0,
            modestbranding: 1
          },
          events: {
            onReady: event => event.target.playVideo(),
            onStateChange: event => {
              if (event.data === YT.PlayerState.ENDED) {
                document.getElementById('player').style.display = 'none';
                document.getElementById('getCodeBtn').style.display = 'inline-block';
              }
            }
          }
        });
      };
    });

  document.getElementById("getCodeBtn").addEventListener("click", () => {
    document.getElementById("couponPage").style.display = "block";
    window.scrollTo(0, document.body.scrollHeight);
  });

  function findCoupon() {
    const selectedMerchant = document.getElementById("merchantSelect").value;
    const resultDiv = document.getElementById("couponResult");

    fetch('https://raw.githubusercontent.com/rajiprem72/discount-code-finder/main/coupons.json')
      .then(response => response.json())
      .then(coupons => {
        const merchantCoupons = coupons.filter(c => c.merchant === selectedMerchant);
        if (merchantCoupons.length > 0) {
          let html = `<h3>Available Coupons for ${selectedMerchant}</h3>`;
          merchantCoupons.forEach(coupon => {
            html += `<p><b>${coupon.code}</b>: ${coupon.description} 
            <a href="${coupon.link}" target="_blank">Shop Now</a></p>`;
          });
          resultDiv.innerHTML = html;
        } else {
          resultDiv.innerHTML = `No coupons available for ${selectedMerchant}.`;
        }
      });
  }
</script>

</body>
</html>
